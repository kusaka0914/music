{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- 検索フォーム -->
    <div class="mb-8">
        <form method="GET" action="{% url 'core:search' %}" class="flex gap-4">
            <input type="text" name="q" value="{{ query }}" 
                   class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                   placeholder="検索キーワードを入力...">
            <select name="type" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="all" {% if search_type == 'all' %}selected{% endif %}>すべて</option>
                <option value="posts" {% if search_type == 'posts' %}selected{% endif %}>投稿</option>
                <option value="users" {% if search_type == 'users' %}selected{% endif %}>ユーザー</option>
                <option value="playlists" {% if search_type == 'playlists' %}selected{% endif %}>プレイリスト</option>
            </select>
            <button type="submit" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                検索
            </button>
        </form>
    </div>

    {% if query %}
        <!-- 検索結果 -->
        {% if search_type == 'all' %}
            <!-- 投稿の検索結果 -->
            {% if posts %}
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4">投稿</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {% for post in posts %}
                            {% include 'core/includes/post_card.html' with post=post %}
                        {% endfor %}
                    </div>
                    {% if posts|length >= 5 %}
                        <a href="?q={{ query }}&type=posts" class="mt-4 inline-block text-blue-500 hover:underline">
                            すべての投稿を見る →
                        </a>
                    {% endif %}
                </div>
            {% endif %}

            <!-- ユーザーの検索結果 -->
            {% if users %}
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4">ユーザー</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {% for user in users %}
                            {% include 'core/includes/user_card.html' with user=user %}
                        {% endfor %}
                    </div>
                    {% if users|length >= 5 %}
                        <a href="?q={{ query }}&type=users" class="mt-4 inline-block text-blue-500 hover:underline">
                            すべてのユーザーを見る →
                        </a>
                    {% endif %}
                </div>
            {% endif %}

            <!-- プレイリストの検索結果 -->
            {% if playlists %}
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4">プレイリスト</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {% for playlist in playlists %}
                            {% include 'core/includes/playlist_card.html' with playlist=playlist %}
                        {% endfor %}
                    </div>
                    {% if playlists|length >= 5 %}
                        <a href="?q={{ query }}&type=playlists" class="mt-4 inline-block text-blue-500 hover:underline">
                            すべてのプレイリストを見る →
                        </a>
                    {% endif %}
                </div>
            {% endif %}

        {% elif search_type == 'posts' %}
            <!-- 投稿のみの検索結果 -->
            {% if posts %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for post in posts %}
                        {% include 'core/includes/post_card.html' with post=post %}
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-center text-gray-500">投稿が見つかりませんでした。</p>
            {% endif %}

        {% elif search_type == 'users' %}
            <!-- ユーザーのみの検索結果 -->
            {% if users %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for user in users %}
                        {% include 'core/includes/user_card.html' with user=user %}
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-center text-gray-500">ユーザーが見つかりませんでした。</p>
            {% endif %}

        {% elif search_type == 'playlists' %}
            <!-- プレイリストのみの検索結果 -->
            {% if playlists %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for playlist in playlists %}
                        {% include 'core/includes/playlist_card.html' with playlist=playlist %}
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-center text-gray-500">プレイリストが見つかりませんでした。</p>
            {% endif %}
        {% endif %}

    {% else %}
        <p class="text-center text-gray-500">検索キーワードを入力してください。</p>
    {% endif %}
</div>
{% endblock %} 